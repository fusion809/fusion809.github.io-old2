<!DOCTYPE html><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Gentoo Development Guide: Completion Files</title>
<link rel="stylesheet" href="../../devmanual.css" type="text/css">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="The Gentoo Devmanual is a technical manual which covers topics such as writing ebuilds and eclasses, and policies that developers should be abiding by.">
<link href="https://1b9a50f4f9de4348cd9f-e703bc50ba0aa66772a874f8c7698be7.ssl.cf5.rackcdn.com/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="https://1b9a50f4f9de4348cd9f-e703bc50ba0aa66772a874f8c7698be7.ssl.cf5.rackcdn.com/tyrian.min.css" rel="stylesheet" media="screen">
<link rel="icon" href="/images/favicon.png" type="image/x-icon">
</head>
<body>
<header><div class="site-title"><div class="container"><div class="row">
<div class="site-title-buttons"><div class="btn-group btn-group-sm">
<a href="https://get.gentoo.org/" role="button" class="btn get-gentoo"><span class="fa fa-fw fa-download"></span><strong> Get Gentoo!</strong></a><div class="btn-group btn-group-sm">
<a class="btn gentoo-org-sites dropdown-toggle" data-toggle="dropdown" data-target="#" href="#"><span class="fa fa-fw fa-map-o"></span><span class="hidden-xs"> gentoo.org sites </span><span class="caret"></span></a><ul class="dropdown-menu dropdown-menu-right">
<li><a href="https://www.gentoo.org/" title="Main Gentoo website"><span class="fa fa-home fa-fw"></span> gentoo.org</a></li>
<li><a href="https://wiki.gentoo.org/" title="Find and contribute documentation"><span class="fa fa-file-text-o fa-fw"></span> Wiki</a></li>
<li><a href="https://bugs.gentoo.org/" title="Report issues and find common issues"><span class="fa fa-bug fa-fw"></span> Bugs</a></li>
<li><a href="https://forums.gentoo.org/" title="Discuss with the community"><span class="fa fa-comments-o fa-fw"></span> Forums</a></li>
<li><a href="https://packages.gentoo.org/" title="Find software for your Gentoo"><span class="fa fa-hdd-o fa-fw"></span> Packages</a></li>
<li class="divider">
<li><a href="https://planet.gentoo.org/" title="Find out what's going on in the developer community"><span class="fa fa-rss fa-fw"></span> Planet</a></li>
<li><a href="https://archives.gentoo.org/" title="Read up on past discussions"><span class="fa fa-archive fa-fw"></span> Archives</a></li>
<li><a href="https://sources.gentoo.org/" title="Browse our source code"><span class="fa fa-code fa-fw"></span> Sources</a></li>
<li class="divider">
<li><a href="https://infra-status.gentoo.org/" title="Get updates on the services provided by Gentoo"><span class="fa fa-server fa-fw"></span> Infra Status</a></li>
</ul>
</div>
</div></div>
<div class="logo">
<a href="/" title="Back to the homepage" class="site-logo"><object data="https://1b9a50f4f9de4348cd9f-e703bc50ba0aa66772a874f8c7698be7.ssl.cf5.rackcdn.com/site-logo.svg" type="image/svg+xml"><img src="https://1b9a50f4f9de4348cd9f-e703bc50ba0aa66772a874f8c7698be7.ssl.cf5.rackcdn.com/site-logo.png" alt="Gentoo Linux Logo"></object></a><span class="site-label">Development Guide</span>
</div>
</div></div></div>
<nav class="tyrian-navbar" role="navigation"><div class="container"><div class="row">
<div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div>
<div class="collapse navbar-collapse navbar-main-collapse"><ul class="nav navbar-nav">
<li><a href="../..//index.html"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Completion Files<span class="caret"></span></a></li>
<li><a href="../index.html"><span class="glyphicon glyphicon-arrow-left"></span>  Tasks Reference</a></li>
<li><a href="../../tasks-reference/environment/index.html">Environment Files  <span class="glyphicon glyphicon-arrow-right"></span></a></li>
</ul></div>
</div></div></nav></header><div class="container"><div class="row"><div class="col-md010"><ol class="breadcrumb">
<li><a href="../../index.html">Master Index</a></li>
<li><a href="../index.html">Tasks Reference</a></li>
</ol></div></div></div>
<div class="container">
<h1 class="first-header">Completion Files</h1>

<p>
Since v2.05a, <code class="docutils literal"><span class="pre">bash</span></code> has offered intelligent programmable completion.  Writing
such completions for your own programs/things you maintain is relatively easy
provided you know bash already. See <a href="../../eclass-reference/bash-completion.eclass/index.html">bash-completion.eclass</a>
for how to install completion files.
</p>

<div class="section">
<h2 id="completion-related-internal-bash-variables">Completion-Related Internal Bash Variables</h2>

<p>
Most of these variables lose their special properties when unset, even if they
are subsequently reset.
</p>

<table class="table">
  <tr>
    <th>
      Variable
    </th>
    <th>
      Purpose
    </th>
  </tr>
  <tr>
    <td class="devbook">
      <code class="docutils literal"><span class="pre">COMP_CWORD</span></code>
    </td>
    <td class="devbook">
      An index into <code class="docutils literal"><span class="pre">${COMP_WORDS}</span></code> of the word containing the
      current cursor position.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      <code class="docutils literal"><span class="pre">COMP_LINE</span></code>
    </td>
    <td class="devbook">
      The current command line.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      <code class="docutils literal"><span class="pre">COMP_POINT</span></code>
    </td>
    <td class="devbook">
      The index of the current cursor position relative to the
      beginning of the current command.  If the current cursor
      position is at the end of the current command, the value
      of this variable is equal to <code class="docutils literal"><span class="pre">${#COMP_LINE}</span></code>.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      <code class="docutils literal"><span class="pre">COMP_WORDBREAKS</span></code>
    </td>
    <td class="devbook">
      The set of characters that the Readline library treats as
      word separators when performing word completion.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      <code class="docutils literal"><span class="pre">COMP_WORDS</span></code>
    </td>
    <td class="devbook">
      An array variable consisting of the individual words in
      the current command line, <code class="docutils literal"><span class="pre">${COMP_LINE}</span></code>.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      <code class="docutils literal"><span class="pre">COMPREPLY</span></code>
    </td>
    <td class="devbook">
      An array variable from which bash reads the possible
      completions generated by a completion function.
    </td>
  </tr>
</table>

</div>

<div class="section">
<h2 id="completion-related-bash-builtins">Completion-Related Bash Builtins</h2>

<p>
See <code class="docutils literal"><span class="pre">man bash</span></code> for a full description of these builtins and their options.
</p>

<table class="table">
  <tr>
    <th>
      Builtin
    </th>
    <th>
      Usage
    </th>
  </tr>
  <tr>
    <td class="devbook">
      <code class="docutils literal"><span class="pre">compgen</span></code>
    </td>
    <td class="devbook">
      <code class="docutils literal"><span class="pre">compgen [-abcdefgjksuv] [-o option] [-A action] [-G globpat]
      [-W wordlist] [-P prefix] [-S suffix] [-X filterpat]
      [-F function] [-C command] [word]</span></code>
      Display the possible completions depending on the options.
      Intended to be used from within a shell function generating
      possible completions. If the optional WORD argument is supplied,
      matches against WORD are generated.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      <code class="docutils literal"><span class="pre">complete</span></code>
    </td>
    <td class="devbook">
      <code class="docutils literal"><span class="pre">complete [-abcdefgjksuv] [-pr] [-o option] [-A action]
      [-G globpat] [-W wordlist] [-P prefix] [-S suffix]
      [-X filterpat] [-F function] [-C command] [name ...]</span></code>
      For each NAME, specify how arguments are to be completed.
      If the -p option is supplied, or if no options are supplied,
      existing completion specifications are printed in a way that
      allows them to be reused as input.  The -r option removes a
      completion specification for each NAME, or, if no NAMEs are
      supplied, all completion specifications.
    </td>
  </tr>
</table>

<p>
For extremely simple cases, a simple <code class="docutils literal"><span class="pre">complete</span></code> statement is all that is
needed.  For example, minimal <code class="docutils literal"><span class="pre">cd</span></code> completion (minimal as in no support for
<code class="docutils literal"><span class="pre">${CDPATH}</span></code>) would be as simple as:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">complete</span> -o nospace -d <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">cd</span>
</span></pre>

</div>

<div class="section">
<h2 id="anatomy-of-a-completion-function">Anatomy of a Completion Function</h2>

<p>
Nearly all completion functions will start out the same way. For these cases,
the following can be used as a template for creating new completion functions:
</p>

<pre><span class="Constant"><span style="float: left;">01: </span><span xmlns="http://www.w3.org/1999/xhtml" class="Special">_foo()</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">{</span>
<span style="float: left;">02: </span>    <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">local</span> cur prev opts
<span style="float: left;">03: </span>    <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">COMPREPLY</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>()
<span style="float: left;">04: </span>    <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">cur</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${COMP_WORDS[COMP_CWORD]}</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
<span style="float: left;">05: </span>    <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">prev</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${COMP_WORDS[COMP_CWORD-1]}</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
<span style="float: left;">06: </span>    <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">opts</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
<span style="float: left;">07: </span>
<span style="float: left;">08: </span>    <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">if</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">[[</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${cur}</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier"></span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>= -* <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">||</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${COMP_CWORD}</span> -eq 1 <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">]]</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">;</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">then</span>
<span style="float: left;">09: </span>        <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">COMPREPLY</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">$(</span>compgen -W <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${opts}</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">--</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"></span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${cur}</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
<span style="float: left;">10: </span>        <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">return</span> 0
<span style="float: left;">11: </span>    <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">fi</span>
<span style="float: left;">12: </span>
<span style="float: left;">13: </span>    <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">case</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${prev}</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">in</span>
<span style="float: left;">14: </span>      <span xmlns="http://www.w3.org/1999/xhtml" class="Comment">#</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">...</span>
<span style="float: left;">15: </span>    <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">esac</span>
<span style="float: left;">16: </span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">}</span>
<span style="float: left;">17: </span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">complete</span> -F _foo foo
</span></pre>

<table class="table">
  <tr>
    <th>
      Line
    </th>
    <th>
      Explanation
    </th>
  </tr>
  <tr>
    <td class="devbook">
      1
    </td>
    <td class="devbook">
      The convention for completion function names is usually _NAME, where NAME
      is the name of the application/function you are writing the completion
      function for.  If NAME contains a '-', it should be replaced with a '_'.
      Hence bash-completion-config would be _bash_completion_config().  Failing
      to do so can cause weird bugs if bash is invoked in POSIX-mode while a
      function name containing a '-' is in the environment (POSIX sh does not
      allow a '-' in function names).
    </td>
  </tr>
  <tr>
    <td class="devbook">
      3
    </td>
    <td class="devbook">
      Resets the <code class="docutils literal"><span class="pre">${COMPREPLY}</span></code> array, as it may be set from a previous
      invocation.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      4
    </td>
    <td class="devbook">
      Sets the local variable, <code class="docutils literal"><span class="pre">${cur}</span></code> to the current word of the command line.
      If the current command line, <code class="docutils literal"><span class="pre">${COMP_LINE}</span></code> is say 'foo --fil', <code class="docutils literal"><span class="pre">${cur}</span></code>
      would be equal to '--fil'.  If <code class="docutils literal"><span class="pre">${COMP_LINE}</span></code> is equal to 'foo --file '
      (note the space at the end), <code class="docutils literal"><span class="pre">${cur}</span></code> is null.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      5
    </td>
    <td class="devbook">
      Sets the local variable, <code class="docutils literal"><span class="pre">${prev}</span></code> to the previous word of the command
      line.  <code class="docutils literal"><span class="pre">${prev}</span></code> is the word before <code class="docutils literal"><span class="pre">${cur}</span></code>.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      6
    </td>
    <td class="devbook">
      Sets the local variable, <code class="docutils literal"><span class="pre">${opts}</span></code>.  In a real completion function, this
      variable would be set to all the options that <code class="docutils literal"><span class="pre">foo</span></code> recognizes.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      8
    </td>
    <td class="devbook">
      Tests whether or not the current word is equivalent to -* (an option) or if
      we're completing on the first word (ie. <code class="docutils literal"><span class="pre">${COMP_CWORD}</span></code> == 1).
    </td>
  </tr>
  <tr>
    <td class="devbook">
      9
    </td>
    <td class="devbook">
      If the test returns true, show the available options, <code class="docutils literal"><span class="pre">${opts}</span></code>. The -W
      option to <code class="docutils literal"><span class="pre">compgen</span></code> tells bash to complete on the word list (string or
      something that evaluates to a string).  In the majority of cases, you'll
      pass <code class="docutils literal"><span class="pre">'-- ${cur}'</span></code> to <code class="docutils literal"><span class="pre">compgen</span></code> telling it to only return those
      completions that match <code class="docutils literal"><span class="pre">${cur}</span></code>.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      13
    </td>
    <td class="devbook">
      Most of the time, you'll want to perform a certain action if <code class="docutils literal"><span class="pre">${prev}</span></code> is
      equal to a certain option.  For example, if <code class="docutils literal"><span class="pre">foo</span></code> has a --file option
      (and -f for short) that takes any kind file, you could do:
      <pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">case</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${prev}</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">in</span>
    -f|<span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">--</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">file</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
        <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">COMPREPLY</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">$(</span>compgen <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">-f</span> ? <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${cur}</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
        ;;
<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">esac</span></span></pre>
    </td>
  </tr>
  <tr>
    <td class="devbook">
      17
    </td>
    <td class="devbook">
      Tells bash to use the <code class="docutils literal"><span class="pre">_foo</span></code> function to generate any completions for
      the <code class="docutils literal"><span class="pre">foo</span></code> application/function.
    </td>
  </tr>
</table>

</div>

<div class="section">
<h2 id="real-world-example">Real-World Example</h2>

<p>
For this document, I will take you through a real-world example and write a
real completion function for <code class="docutils literal"><span class="pre">revdep-rebuild</span></code> (might even be available in
<code class="docutils literal"><span class="pre">gentoo-bashcomp</span></code> by the time you read this :]).
</p>

<pre><span class="Constant"><span style="float: left;">01: </span><span xmlns="http://www.w3.org/1999/xhtml" class="Special">_revdep_rebuild()</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">{</span>
<span style="float: left;">02: </span>	<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">local</span> cur prev opts
<span style="float: left;">03: </span>	<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">COMPREPLY</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>()
<span style="float: left;">04: </span>	<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">cur</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${COMP_WORDS[COMP_CWORD]}</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
<span style="float: left;">05: </span>	<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">prev</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${COMP_WORDS[COMP_CWORD-1]}</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
<span style="float: left;">06: </span>	<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">opts</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>-X --package-names --soname --soname-regexp -q --quiet<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
<span style="float: left;">07: </span>
<span style="float: left;">08: </span>	<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">if</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">[[</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${cur}</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier"></span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>= -* <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">||</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${COMP_CWORD}</span> -eq 1 <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">]]</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">||</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">\</span>
<span style="float: left;">09: </span>	   <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">[[</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${prev}</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier"></span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>= @(-q|<span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">--</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">quiet</span>) <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">]]</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">;</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">then</span>
<span style="float: left;">10: </span>		<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">COMPREPLY</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">$(</span>compgen -W <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${opts}</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">--</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"></span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${cur}</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
<span style="float: left;">11: </span>		<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">return</span> 0
<span style="float: left;">12: </span>	<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">fi</span>
<span style="float: left;">13: </span> 
<span style="float: left;">14: </span>	<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">case</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${prev}</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">in</span>
<span style="float: left;">15: </span>		-X|<span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">--</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">package-names</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
<span style="float: left;">16: </span>			_pkgname -I <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${cur}</span>
<span style="float: left;">17: </span>			;;
<span style="float: left;">18: </span>		<span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">--</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">soname</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
<span style="float: left;">19: </span>			<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">local</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">sonames</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">$(</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">for</span> x <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">in</span> /lib/*.so?(.)* /usr/lib*/*.so\?(.)* <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">;</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">do</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">\</span>
<span style="float: left;">20: </span>						<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">echo</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${x##*/}</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">;</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">\</span>
<span style="float: left;">21: </span>						<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">done</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
<span style="float: left;">22: </span>			<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">COMPREPLY</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">$(</span>compgen -W <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${sonames}</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">--</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"></span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${cur}</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
<span style="float: left;">23: </span>			;;
<span style="float: left;">24: </span>		<span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">--</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">soname-regexp</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
<span style="float: left;">25: </span>			<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">COMPREPLY</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>()
<span style="float: left;">26: </span>			;;
<span style="float: left;">27: </span>		*<span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
<span style="float: left;">28: </span>			<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">if</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">[[</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${COMP_LINE}</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier"></span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>= *<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>@(-X|<span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">--</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">package-names</span>)* <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">]]</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">;</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">then</span>
<span style="float: left;">29: </span>				_pkgname -I <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${cur}</span>
<span style="float: left;">30: </span>				<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">COMPREPLY</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${COMPREPLY[@]}</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">$(</span>compgen -W <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${opts}</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
<span style="float: left;">31: </span>			<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">else</span>
<span style="float: left;">32: </span>				<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">COMPREPLY</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">$(</span>compgen -W <span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${opts}</span> -- <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${cur}</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
<span style="float: left;">33: </span>			<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">fi</span>
<span style="float: left;">34: </span>		;;
<span style="float: left;">35: </span>	<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">esac</span>
<span style="float: left;">36: </span><span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">}</span>
<span style="float: left;">37: </span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">complete</span> -F _revdep_rebuild revdep-rebuild
</span></pre>

<p>
Lines 1-12 are pretty much the same as in the previous section.
</p>

<table class="table">
  <tr>
    <th>
      Line
    </th>
    <th>
      Explanation
    </th>
  </tr>
  <tr>
    <td class="devbook">
      15
    </td>
    <td class="devbook">
      If <code class="docutils literal"><span class="pre">${prev}</span></code> is equal to <code class="docutils literal"><span class="pre">-X</span></code>
      or <code class="docutils literal"><span class="pre">--package-names</span></code>, call <code class="docutils literal"><span class="pre">_pkgname</span></code> (a function
      defined by <code class="docutils literal"><span class="pre">gentoo-bashcomp</span></code> that completes on package
      names - it sets <code class="docutils literal"><span class="pre">${COMPREPLY}</span></code>, so we don't worry about
      that here).
    </td>
  </tr>
  <tr>
    <td class="devbook">
      18
    </td>
    <td class="devbook">
      If <code class="docutils literal"><span class="pre">${prev}</span></code> is equal to <code class="docutils literal"><span class="pre">--soname</span></code>, generate a list
      of all shared libs in <code class="docutils literal"><span class="pre">/lib</span></code> and <code class="docutils literal"><span class="pre">/usr/lib*</span></code>. Pass
      that list to <code class="docutils literal"><span class="pre">compgen</span></code> to generate a list of possible
      completions that match <code class="docutils literal"><span class="pre">${cur}</span></code>.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      24
    </td>
    <td class="devbook">
      Obviously we cannot complete on any regexp's so if <code class="docutils literal"><span class="pre">${prev}</span></code> is equal
      to <code class="docutils literal"><span class="pre">--soname-regexp</span></code>, do nothing.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      27
    </td>
    <td class="devbook">
      For anything else (any options not specified in the case statement above
      OR any argument to one of the options specified in the case statement)
      perform the tests. Since <code class="docutils literal"><span class="pre">--package-names</span></code> can take multiple package
      names, we want to continue to complete on package names until another
      recognized option is encountered (ie. is <code class="docutils literal"><span class="pre">${prev}</span></code>).
    </td>
  </tr>
  <tr>
    <td class="devbook">
      30
    </td>
    <td class="devbook">
      Since <code class="docutils literal"><span class="pre">_pkgname</span></code> sets <code class="docutils literal"><span class="pre">${COMPREPLY}</span></code> and we want to add to that list,
      we have to use the <code class="docutils literal"><span class="pre">COMPREPLY=(${COMPREPLY[@] ... )</span></code> construct.
    </td>
  </tr>
  <tr>
    <td class="devbook">
      37
    </td>
    <td class="devbook">
      Tell bash to use <code class="docutils literal"><span class="pre">_revdep_rebuild</span></code> to generate all possible completions
      for revdep-rebuild.
    </td>
  </tr>
</table>

</div>


</div>
<footer><div class="container">
<div class="row">
<div class="col-xs-12 col-md-offset-2 col-md-7"></div>
<div class="col-xs-12 col-md-3">
<h3 class="footerhead">Questions or comments?</h3>
              Please feel free to <a href="https://www.gentoo.org/inside-gentoo/contact/">contact us</a>.
            </div>
</div>
<div class="row">
<div class="col-xs-2 col-sm-3 col-md-2"><ul class="footerlinks three-icons">
<li><a href="http://twitter.com/gentoo" title="@Gentoo on Twitter"><span class="fa fa-twitter fa-fw"></span></a></li>
<li><a href="https://plus.google.com/+Gentoo" title="+Gentoo on Google+"><span class="fa fa-google-plus fa-fw"></span></a></li>
<li><a href="https://www.facebook.com/gentoo.org" title="Gentoo on Facebook"><span class="fa fa-facebook fa-fw"></span></a></li>
</ul></div>
<div class="col-xs-10 col-sm-9 col-md-10">
<strong>Copyright (C) 2001-2015 Gentoo Foundation, Inc.</strong><br><small>
                Gentoo is a trademark of the Gentoo Foundation, Inc.
                The text of this document is distributed under the <a href="http://creativecommons.org/licenses/by-sa/2.0/">Creative Commons Attribution-ShareAlike 2.0 License</a>.
                The <a href="https://www.gentoo.org/inside-gentoo/foundation/name-logo-guidelines.html">Gentoo Name and Logo Usage Guidelines</a> apply.
              </small>
</div>
</div>
</div></footer><script src="https://1b9a50f4f9de4348cd9f-e703bc50ba0aa66772a874f8c7698be7.ssl.cf5.rackcdn.com/jquery.min.js"></script><script src="https://1b9a50f4f9de4348cd9f-e703bc50ba0aa66772a874f8c7698be7.ssl.cf5.rackcdn.com/bootstrap.min.js"></script>
</body>
</html>
